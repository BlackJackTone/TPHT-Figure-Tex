\newcommand{\addIntroDataPlot}[4]{%
\addplot[#1] table[x expr=#2, y expr=\thisrowno{#4}/1000000, restrict expr to domain={\thisrow{object_id}}{#3:#3}]{\ycsbintrodata};%
}

\newcommand{\addAllIntroLoadPlots}{%
\addIntroDataPlot{CuckooStyle}{1.0}{6}{1}
\addIntroDataPlot{IcebergStyle}{1.1}{7}{1}
\addIntroDataPlot{JunctionStyle}{1.2}{15}{1}
\addIntroDataPlot{TBBStyle}{1.3}{24}{1}
\addIntroDataPlot{TPHTStyle}{1.4}{17}{1}
\addIntroDataPlot{BlastStyle}{1.5}{20}{1}
}

\newcommand{\addAllIntroRunPlots}{%
\addIntroDataPlot{CuckooStyle}{6.0}{6}{2}
\addIntroDataPlot{IcebergStyle}{6.1}{7}{2}
\addIntroDataPlot{JunctionStyle}{6.2}{15}{2}
\addIntroDataPlot{TBBStyle}{6.3}{24}{2}
\addIntroDataPlot{TPHTStyle}{6.4}{17}{2}
\addIntroDataPlot{BlastStyle}{6.5}{20}{2}
}

\newcommand{\addSpaceEffPlot}[3]{%
\addplot[#1] table[x expr=#2, y expr=\thisrowno{1}*100, restrict expr to domain={\thisrow{object_id}}{#3:#3}]{\maxspaceeffdata};%
}

\newcommand{\addAllSpaceEffPlots}{%
\addSpaceEffPlot{CuckooStyle}{0.0}{6}
\addSpaceEffPlot{IcebergStyle}{0.1}{7}
\addSpaceEffPlot{JunctionStyle}{0.2}{15}
\addSpaceEffPlot{TBBStyle}{0.3}{24}
\addSpaceEffPlot{TPHTStyle}{0.4}{17}
\addSpaceEffPlot{BlastStyle}{0.5}{23}
}

\begin{figure}[h]
    \centering
    
    \pgfplotslegendfromname{intro-legend-horizontal}
    
    % Subfigure (a): Throughput comparison (Load vs Run)
    \begin{subfigure}[t]{0.6\linewidth}
    \centering
    \begin{tikzpicture}
    \begin{axis}[
        width=\linewidth,
        height=4.2cm,
        ylabel={Throughput (M/s)},
        ylabel style={at={(ticklabel* cs:1.02)}, anchor=south},
        xlabel={},
        ybar,
        bar width=3pt,
        xtick={},
        xticklabels={},
        xtick style={draw=none},
        axis lines=box,
        tick align=inside,
        scaled ticks=true,
        tick label style={/pgf/number format/fixed,/pgf/number format/precision=1},
        ymajorgrids=true,
        yminorgrids=true,
        minor tick num=1,
        max space between ticks=35pt,
        try min ticks=5,
        grid style={gray!30},
        ymin=0,
        xmin=-5,
        xmax=13.5,
        legend entries = {\htthree, \htfour, \htfive, \htsix, \htone, \httwo},
        legend cell align = left,
        legend style={draw=none, legend columns=3, /tikz/every even column/.append style={column sep=0.3cm}},
        legend to name={intro-legend-horizontal}
    ]
    \addAllIntroLoadPlots
    \addAllIntroRunPlots
    
    % Add group labels
    \node at (axis cs:-1,375) {\text{Load}};
    \node at (axis cs:8.7,375) {\text{Run}};
    \end{axis}
    \end{tikzpicture}
    \caption{Throughput comparison on YCSB load and run phases.}
    \label{fig:intro_throughput}
    \end{subfigure}%
    \hfill
    % Subfigure (b): Space efficiency comparison
    \begin{subfigure}[t]{0.38\linewidth}
    \centering
    \begin{tikzpicture}
    \begin{axis}[
        width=\linewidth,
        height=4.2cm,
        ylabel={Space Efficiency (\%)},
        ylabel style={at={(ticklabel* cs:1.02)}, anchor=south},
        xlabel={},
        ybar,
        bar width=3pt,
        xticklabels={},
        xtick style={draw=none},
        axis lines=box,
        tick align=inside,
        scaled ticks=true,
        tick label style={/pgf/number format/fixed,/pgf/number format/precision=2},
        ymajorgrids=true,
        yminorgrids=true,
        minor tick num=1,
        max space between ticks=35pt,
        try min ticks=5,
        grid style={gray!30},
        ymin=0,
        xmin=-2.5,
        xmax=3
    ]
    
    % Space efficiency data (from max_space_efficiency.csv)
    \addAllSpaceEffPlots
    
    \end{axis}
    \end{tikzpicture}
    \caption{Maximum space efficiency achieved by each method.}
    \label{fig:intro_space_efficiency}
    \end{subfigure}
    \caption{Introduction to hash table performance: (a) Throughput comparison between Load and Run phases, (b) Maximum space efficiency achieved by each method.}
    \label{fig:intro_figure}
\end{figure}
