\newcommand{\addIntroDataPlot}[4]{%
\addplot[#1] table[x expr=#2, y expr=\thisrowno{#4}/1000000, restrict expr to domain={\thisrow{object_id}}{#3:#3}]{\ycsbintrodata};%
}

\newcommand{\addAllIntroLoadPlots}{%
\addIntroDataPlot{CuckooStyle}{1}{6}{1}
\addIntroDataPlot{IcebergStyle}{2}{7}{1}
\addIntroDataPlot{JunctionStyle}{3}{15}{1}
\addIntroDataPlot{TPHTStyle}{4}{17}{1}
\addIntroDataPlot{BlastStyle}{5}{20}{1}
}

\newcommand{\addAllIntroRunPlots}{%
\addIntroDataPlot{CuckooStyle}{10}{6}{2}
\addIntroDataPlot{IcebergStyle}{11}{7}{2}
\addIntroDataPlot{JunctionStyle}{12}{15}{2}
\addIntroDataPlot{TPHTStyle}{13}{17}{2}
\addIntroDataPlot{BlastStyle}{14}{20}{2}
}

\newcommand{\addSpaceEffPlot}[3]{%
\addplot[#1] table[x expr=#2, y expr=\thisrowno{1}, restrict expr to domain={\thisrow{object_id}}{#3:#3}]{\maxspaceeffdata};%
}

\newcommand{\addAllSpaceEffPlots}{%
\addSpaceEffPlot{CuckooStyle}{0}{6}
\addSpaceEffPlot{IcebergStyle}{1}{7}
\addSpaceEffPlot{JunctionStyle}{2}{15}
\addSpaceEffPlot{TPHTStyle}{3}{17}
\addSpaceEffPlot{BlastStyle}{4}{20}
}

\begin{figure}[h]
    \centering
    
    \pgfplotslegendfromname{intro-legend-horizontal}
    
    % Subfigure (a): Throughput comparison (Load vs Run)
    \begin{subfigure}[t]{0.6\linewidth}
    \centering
    \begin{tikzpicture}
    \begin{axis}[
        width=\linewidth,
        height=6cm,
        ylabel={Throughput (M ops/s)},
        ylabel style={at={(ticklabel* cs:1.02)}, anchor=south},
        xlabel={},
        ybar,
        bar width=3pt,
        xtick={0,15},
        xticklabels={},
        xtick style={draw=none},
        axis lines=box,
        tick align=inside,
        scaled ticks=true,
        tick label style={/pgf/number format/fixed,/pgf/number format/precision=1},
        ymajorgrids=true,
        yminorgrids=true,
        minor tick num=1,
        max space between ticks=35pt,
        try min ticks=5,
        grid style={gray!30},
        ymin=0,
        xmin=-1,
        xmax=16,
        legend entries = {\htthree, \htfour, \htfive, \htone, \httwo},
        legend cell align = left,
        legend style={draw=none, legend columns=5, /tikz/every even column/.append style={column sep=0.5cm}},
        legend to name={intro-legend-horizontal}
    ]
    \addAllIntroLoadPlots
    \addAllIntroRunPlots
    \end{axis}
    \end{tikzpicture}
    \caption{Throughput comparison between Load and Run phases}
    \label{fig:intro_throughput}
    \end{subfigure}%
    % Subfigure (b): Space efficiency comparison
    \begin{subfigure}[t]{0.38\linewidth}
    \centering
    \begin{tikzpicture}
    \begin{axis}[
        width=\linewidth,
        height=6cm,
        ylabel={Space Efficiency},
        ylabel style={at={(ticklabel* cs:1.02)}, anchor=south},
        xlabel={},
        ybar,
        bar width=3pt,
        xticklabels={},
        xtick style={draw=none},
        axis lines=box,
        tick align=inside,
        scaled ticks=true,
        tick label style={/pgf/number format/fixed,/pgf/number format/precision=2},
        ymajorgrids=true,
        yminorgrids=true,
        minor tick num=1,
        max space between ticks=35pt,
        try min ticks=5,
        grid style={gray!30},
        ymin=0,
        xmin=-1,
        xmax=5,
        legend entries = {\htthree, \htfour, \htfive, \htone, \httwo},
        legend cell align = left,
        legend style={draw=none, legend columns=5, /tikz/every even column/.append style={column sep=0.5cm}},
        legend to name={intro-legend-horizontal}
    ]
    
    % Space efficiency data (from max_space_efficiency.csv)
    \addAllSpaceEffPlots
    
    \end{axis}
    \end{tikzpicture}
    \caption{Maximum space efficiency achieved by each method}
    \label{fig:intro_space_efficiency}
    \end{subfigure}
    \caption{Introduction to hash table performance: (a) Throughput comparison between Load and Run phases, (b) Maximum space efficiency achieved by each method.}
    \label{fig:intro_figure}
\end{figure}
